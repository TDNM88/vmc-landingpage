<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xóa Nền Ảnh</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta.3/css/all.min.css">
    <style>
        /* CSS cho nút */
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px 0;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            text-decoration: none;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        .error-message {
            color: red;
            margin-top: 20px;
        }

        #result {
            margin-top: 20px;
        }

        #processedImage {
            max-width: 100%;
            height: auto;
            display: none;
        }

        .upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .upload-container input {
            margin-bottom: 10px;
        }

        .upload-container video {
            display: none;
            max-width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li><a href="/index.html"><i class="fas fa-home"></i><span>Trang chủ</span></a></li>
                <li><a href="vmc.html"><i class="fas fa-project-diagram"></i><span>Dự án VMC</span></a></li>
                <li><a href="mkt.html"><i class="fas fa-bullhorn"></i><span>Dịch vụ Marketing</span></a></li>
                <li><a href="projects.html"><i class="fas fa-th-large"></i><span>Các ứng dụng</span></a></li>
                <li><a href="aig.html"><i class="fas fa-robot"></i><span>AIGC</span></a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="overlay">
                <div class="container">
                    <h1>Tải Ảnh Lên và Xóa Nền</h1>
                    <div class="upload-container">
                        <input type="file" id="imageUpload" accept="image/*">
                        <button id="cameraButton" class="btn"><i class="fas fa-camera"></i> Sử dụng Camera</button>
                        <video id="video" autoplay></video>
                        <button id="captureButton" class="btn" style="display: none;"><i class="fas fa-camera"></i> Chụp Ảnh</button>
                        <button id="uploadButton" class="btn"><i class="fas fa-upload"></i> Tải lên và Xử lý</button>
                    </div>
                    <div id="result">
                        <h2>Ảnh đã xử lý:</h2>
                        <img id="processedImage" src="" alt="Processed Image">
                    </div>
                    <div id="error" class="error-message"></div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 TDN-M. Bản quyền thuộc về TDN-M. Website đang trong quá trình xây dựng, nếu có thắc mắc cần giải đáp, vui lòng kết nối với chúng tôi qua Super Care 247 bằng cách nhấn nút bên phải màn hình</p>
        </div>
    </footer>

    <script type="module">
        import { Client } from "@gradio/client";

        const fileInput = document.getElementById('imageUpload');
        const cameraButton = document.getElementById('cameraButton');
        const video = document.getElementById('video');
        const captureButton = document.getElementById('captureButton');
        const uploadButton = document.getElementById('uploadButton');
        const errorDiv = document.getElementById('error');
        const processedImage = document.getElementById('processedImage');

        cameraButton.addEventListener('click', () => {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                    video.style.display = 'block';
                    captureButton.style.display = 'block';
                    cameraButton.style.display = 'none';
                })
                .catch(err => {
                    console.error('Error accessing camera: ', err);
                    errorDiv.textContent = 'Không thể truy cập camera.';
                });
        });

        captureButton.addEventListener('click', () => {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            canvas.toBlob(blob => {
                fileInput.files = new FileListItems([new File([blob], 'capture.png', { type: 'image/png' })]);
                video.style.display = 'none';
                captureButton.style.display = 'none';
                cameraButton.style.display = 'block';
                const stream = video.srcObject;
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
            });
        });

        uploadButton.addEventListener('click', async () => {
            const file = fileInput.files[0];

            // Reset error message and processed image
            errorDiv.textContent = '';
            processedImage.style.display = 'none';

            if (!file) {
                errorDiv.textContent = 'Vui lòng chọn một ảnh để tải lên.';
                return;
            }

            try {
                const client = await Client.connect("TDN-M/Xoanenanh");
                const result = await client.predict("/predict", { image: file });

                if (result.data) {
                    processedImage.src = result.data;
                    processedImage.style.display = 'block';
                } else {
                    throw new Error('Không nhận được dữ liệu từ API.');
                }
            } catch (error) {
                console.error('Error:', error);
                errorDiv.textContent = 'Đã xảy ra lỗi trong quá trình xử lý ảnh: ' + error.message;
            }
        });

        // Helper function to create a FileList
        function FileListItems(files) {
            const b = new ClipboardEvent("").clipboardData || new DataTransfer();
            for (let i = 0, len = files.length; i < len; i++) b.items.add(files[i]);
            return b.files;
        }
    </script>
</body>
</html>